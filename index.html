<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UAV Visual Localization</title>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #ffffff;
      min-height: 100vh;
    }

    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&display=swap');

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      padding: 30px 20px;
      color: #333;
      background: #f8f9fa;
    }

    .hero h1 {
      font-size: 3em;
      margin-bottom: 15px;
      font-weight: 900;
      color: #1a1a1a;
      text-align: center;
      font-family: 'Playfair Display', serif;
      letter-spacing: -0.5px;
    }

    .hero-content {
      display: flex;
      align-items: center;
      gap: 40px;
      max-width: 1200px;
      margin: 0 auto;
      margin-top: 20px;
    }

    .hero-image-container {
      flex: 0 0 45%;
    }

    .hero-image {
      width: 100%;
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }

    .hero-text {
      flex: 1;
      text-align: left;
    }

    .author-note {
      font-size: 0.95em;
      color: #666;
      margin-bottom: 15px;
      font-style: italic;
    }

    .author-note a {
      color: #333;
      text-decoration: none;
      font-weight: 500;
      border-bottom: 1px solid #999;
    }

    .author-note a:hover {
      color: #000;
      border-bottom-color: #333;
    }

    .hero-description {
      font-size: 1em;
      color: #666;
      line-height: 1.8;
      text-align: justify;
    }

    /* Navigation Menu */
    .nav-menu {
      background: transparent;
      padding: 40px 0;
      margin: 30px auto;
      position: relative;
      max-width: 1100px;
    }

    .nav-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #333;
      margin-right: 30px;
      white-space: nowrap;
    }

    .nav-container {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      max-width: 1100px;
      margin: 0 auto;
    }

    .nav-line-left,
    .nav-line-right {
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, #bbb, #ddd);
    }

    .nav-cards-container {
      display: flex;
      gap: 0;
      justify-content: space-between;
      align-items: center;
      width: 930px;
      position: relative;
    }

    .nav-line {
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, #bbb, #ddd);
      align-self: center;
    }

    .nav-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 20px 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #e0e0e0;
      max-width: 280px;
      min-width: 260px;
      flex: 0 0 auto;
      position: relative;
      z-index: 1;
    }

    .nav-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      border-color: #999;
      background: #f8f9fa;
    }

    .nav-card h3 {
      color: #333;
      font-size: 1.2em;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-card-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .nav-card p {
      color: #666;
      font-size: 0.9em;
      line-height: 1.4;
    }

    /* Project Sections */
    .project-section {
      background: #ffffff;
      border-radius: 15px;
      padding: 50px;
      margin: 40px auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      scroll-margin-top: 20px;
      max-width: 1200px;
    }

    .project-header {
      padding-bottom: 25px;
      margin-bottom: 25px;
    }

    .project-header h1 {
      font-size: 2em;
      color: #333;
      margin-bottom: 10px;
    }

    .project-header .subtitle {
      font-size: 1em;
      color: #666;
      font-weight: 400;
      line-height: 1.4;
    }

    .authors {
      margin: 20px 0;
    }

    .authors .names {
      font-size: 1.1em;
      margin-bottom: 8px;
    }

    .authors .names a {
      color: #333;
      text-decoration: none;
      transition: color 0.3s;
    }

    .authors .names a:hover {
      color: #666;
      text-decoration: underline;
    }

    .authors .affiliations {
      color: #666;
      font-size: 0.95em;
    }

    .links {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .links a {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: #333;
      color: white;
      text-decoration: none;
      border-radius: 20px;
      transition: all 0.3s;
      font-weight: 500;
      font-size: 0.9em;
    }

    .links a:hover {
      background: #555;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .links img {
      width: 18px;
      height: 18px;
      filter: brightness(0) invert(1);
    }

    /* Content Sections */
    h2 {
      color: #333;
      font-size: 1.5em;
      margin: 25px 0 15px 0;
      padding-bottom: 8px;
    }

    .sec-abstract {
      margin: 30px 0;
    }

    .sec-abstract p {
      text-align: justify;
      color: #444;
      line-height: 1.8;
    }

    .sec-pipeline, .sec-video {
      text-align: center;
      margin: 40px 0;
    }

    .sec-pipeline img {
      max-width: 900px;
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      margin-top: 20px;
    }

    .full-width-video {
      width: 100%;
      max-width: 900px;
      height: 500px;
      border-radius: 10px;
      margin-top: 20px;
    }

    /* Example Results */
    .sec-results {
      max-width: 1200px;
      margin: 0 auto;
    }

    .example-queries {
      width: 100%;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      gap: 0.75rem;
      height: 14rem;
      margin: 30px 0;
    }

    .example-query {
      height: 13.25rem;
      cursor: pointer;
      transition: border-bottom 0.3s;
      flex: 1;
    }

    .example-query img {
      height: 100%;
      width: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }

    .example-query:hover {
      border-bottom: 0.75rem solid #999;
    }

    .example-query.active {
      border-bottom: 0.75rem solid #015C92;
    }

    .map-marker {
      background-color: #fff;
      box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
      height: 80px;
      width: auto;
      border: 2px solid white;
      cursor: zoom-in;
      border-radius: 4px;
    }

    .map-marker.active {
      height: 280px;
      z-index: 1000 !important;
      cursor: zoom-out;
    }

    #map {
      width: 100%;
      height: 600px;
      border-radius: 10px;
      margin: 20px 0;
    }

    /* Mapbox popup image size */
    .mapboxgl-popup-content img {
      max-width: 96px !important;
      width: 96px !important;
      height: auto !important;
    }

    /* Back to Top Button */
    .back-to-top {
      position: fixed;
      bottom: 40px;
      right: 40px;
      background: #333;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      transition: all 0.3s;
      opacity: 0;
      visibility: hidden;
    }

    .back-to-top.show {
      opacity: 1;
      visibility: visible;
    }

    .back-to-top:hover {
      background: #555;
      transform: translateY(-5px);
    }

    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2em;
      }

      .hero-content {
        flex-direction: column;
      }

      .hero-image-container {
        flex: 0 0 100%;
      }

      .hero-text {
        text-align: justify;
      }
      
      .project-section {
        padding: 30px 20px;
      }

      .full-width-video {
        height: 300px;
      }

      .nav-title {
        display: none;
      }

      .nav-container {
        flex-direction: column;
        gap: 20px;
      }

      .nav-cards-container {
        flex-direction: column;
        align-items: stretch;
        width: 100%;
      }

      .nav-line {
        display: none;
      }

      .nav-line-left,
      .nav-line-right {
        display: none;
      }

      .nav-card {
        max-width: 100%;
      }

      .sec-pipeline img {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="hero">
    <div class="container">
      <h1>UAV Visual Localization</h1>
      <div class="hero-content">
        <div class="hero-image-container">
          <img src="teaser.png" alt="UAV Visual Geolocalization Overview" class="hero-image">
        </div>
        <div class="hero-text">
          <div class="author-note">
            A series of research works by <a href="https://boni-hu.github.io/" target="_blank">Boni Hu</a>
          </div>
          <div class="hero-description">
            This portfolio presents a series of research works focused on visual geolocalization and relocalization for unmanned aerial vehicles (UAVs). Our research addresses critical challenges in cross-domain matching, orientation estimation, and 6-DoF pose estimation under extreme viewpoint variations, appearance changes, and large-scale scenarios. Through innovative multistage refinement pipelines, learning strategies, and novel scene representations, we advance the state-of-the-art in practical UAV navigation systems for applications including GPS-denied navigation, aerial mapping, and intelligent surveillance.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="nav-menu">
      <div class="nav-container">
        <div class="nav-title">Projects</div>
        <div class="nav-line-left"></div>
        <div class="nav-cards-container">
          <div class="nav-card" onclick="document.getElementById('curriculumloc').scrollIntoView({behavior: 'smooth'})">
            <h3>
              <img src="icons/loc.svg" alt="Location" class="nav-card-icon">
              CurriculumLoc
            </h3>
            <p>Multistage refinement pipeline with keypoint detection for cross-domain UAV geolocalization</p>
          </div>
          
          <div class="nav-line"></div>
          
          <div class="nav-card" onclick="document.getElementById('oriloc').scrollIntoView({behavior: 'smooth'})">
            <h3>
              <img src="icons/loc.svg" alt="Location" class="nav-card-icon">
              OriLoc
            </h3>
            <p>Cross-view geolocalization with orientation estimation for limited FoV scenarios</p>
          </div>
          
          <div class="nav-line"></div>
          
          <div class="nav-card" onclick="document.getElementById('hi2gsloc').scrollIntoView({behavior: 'smooth'})">
            <h3>
              <img src="icons/reloc.svg" alt="Relocalization" class="nav-card-icon">
              Hi²-GSLoc
            </h3>
            <p>Dual-hierarchical Gaussian-based 6-DoF visual relocalization for remote sensing</p>
          </div>
        </div>
        <div class="nav-line-right"></div>
      </div>
    </div>

    <!-- CurriculumLoc Section -->
    <div id="curriculumloc" class="project-section">
      <div class="project-header">
        <h1>CurriculumLoc</h1>
        <div class="subtitle">Enhancing Cross-Domain Geolocalization Through Multistage Refinement</div>
        <div class="authors">
          <div class="names">
            <a href="https://boni-hu.github.io/">Boni Hu</a><sup>1</sup>, 
            <a>Lin Chen</a><sup>1</sup>, 
            <a href="https://boni-hu.github.io/">Runjian Chen</a><sup>2</sup>, 
            <a>Shuhui Bu</a><sup>1</sup>, 
            <a>Pengcheng Han</a><sup>1</sup>, 
            <a>Haowei Li</a><sup>1</sup>
          </div>
          <div class="affiliations">
            <sup>1</sup>Northwestern Polytechnical University, <sup>2</sup>HKU-MMLab, The University of Hong Kong
          </div>
        </div>
        <div class="links">
          <a href="https://ieeexplore.ieee.org/document/10477445">
            <img src="./icons/pdf.svg" alt="Paper"/>
            Paper
          </a>
          <a href="https://www.youtube.com/watch?v=IF1VuWw-dRE">
            <img class="yt" src="./icons/youtube.svg" alt="YouTube"/>
            YouTube
          </a>
          <a href="https://player.bilibili.com/player.html?bvid=BV1K84yzREQv&page=1&high_quality=1">
            <img class="yt" src="./icons/bilibili.jpg" alt="BiliBili"/>
            BiliBili
          </a>
          <a href="https://github.com/boni-hu/CurriculumLoc">
            <img src="./icons/github.svg" alt="Code"/>
            Code
          </a>
          <a href="https://github.com/boni-hu/CurriculumLoc">
            <img src="./icons/images.svg" alt="Data"/>
            Data
          </a>
        </div>
      </div>

      <div class="sec-abstract">
        <h2>Abstract</h2>
        <p>Visual geolocalization is a cost-effective and scalable task that involves matching one or more query images, taken at some unknown location, to a set of geotagged reference images. Existing methods, devoted to semantic features representation, evolving toward robustness to a wide variety between query and reference, including illumination and viewpoint changes, as well as scale and seasonal variations. However, practical visual geolocalization approaches need to be robust in appearance changing and extreme viewpoint variation conditions, while providing accurate global location estimates. Therefore, inspired by curriculum design, human learn general knowledge first and then delve into professional expertise. We first recognize semantic scene and then measure geometric structure. Our approach, termed CurriculumLoc, involves a delicate design of multistage refinement pipeline and a novel keypoint detection and description with global semantic awareness and local geometric verification. We rerank candidates and solve a particular cross-domain perspective-n-point (PnP) problem based on these keypoints and corresponding descriptors, position refinement occurs incrementally. The extensive experimental results on our collected dataset, TerraTrack and a benchmark dataset, ALTO, demonstrate that our approach results in the aforementioned desirable characteristics of a practical visual geolocalization solution. Additionally, we achieve new high recall@1 scores of 62.6% and 94.5% on ALTO, with two different distances metrics, respectively.</p>
      </div>

      <div class="sec-pipeline">
        <h2>Pipeline Overview</h2>
        <img src="pipeline.png" alt="CurriculumLoc Pipeline">
      </div>

      <div class="sec-video">
        <h2>Demo Video</h2>
        <iframe
          class="full-width-video"
          src="https://www.youtube.com/embed/IF1VuWw-dRE"
          title="YouTube video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen
        ></iframe>
      </div>
    </div>

    <!-- OriLoc Section -->
    <div id="oriloc" class="project-section">
      <div class="project-header">
        <h1>OriLoc</h1>
        <div class="subtitle">Enhancing Cross-Domain Geolocalization Through Multistage Refinement</div>
        <div class="authors">
          <div class="names">
            <a href="https://boni-hu.github.io/">Boni Hu</a><sup>1</sup>, 
            <a>Haowei Li</a><sup>1</sup>, 
            <a>Shuhui Bu</a><sup>2</sup>, 
            <a>Lin Chen</a><sup>1</sup>, 
            <a>Pengcheng Han</a><sup>1</sup>
          </div>
          <div class="affiliations">
            <sup>1</sup>Northwestern Polytechnical University
          </div>
        </div>
        <div class="links">
          <a href="https://ieeexplore.ieee.org/document/11037236">
            <img src="./icons/pdf.svg" alt="Paper"/>
            Paper
          </a>
          <a href="https://github.com/boni-hu/OriLoc">
            <img src="./icons/github.svg" alt="Code"/>
            Code
          </a>
        </div>
      </div>

      <div class="sec-abstract">
        <h2>Abstract</h2>
        <p>Cross-view image-based geolocalization enables accurate, drift-free navigation without external positioning signals, crucial for UAV delivery and disaster relief. However, existing research primarily focuses on ground panoramic images with known orientations, while real-world scenarios involve unknown orientations and limited field of view (FoV), creating a research-application gap. We introduce OriLoc, an innovative cross-view geolocalization method integrating sophisticated orientation estimation for limited FoV and arbitrary orientation scenarios. Our approach employs a dual-weighted soft-margin triplet loss with hard sample mining to extract discriminative features. Additionally, we develop an orientation estimation module using convolution-based sliding windows to assess similarity between satellite-view and query embeddings. The method demonstrates superior performance on three challenging datasets spanning commercial, residential, urban, and suburban areas across two continents. Results show that hard sample mining combined with appropriate learning objectives significantly enhances geolocalization for limited FoV and orientation-free images. Our orientation estimation module achieves remarkable accuracy when integrated with attention embeddings prior to polar transformation. Code and trained models are publicly available on https://github.com/boni-hu/OriLoc.</p>
      </div>

      <div class="sec-pipeline">
        <h2>Pipeline Overview</h2>
        <img src="oriloc-1.png" alt="OriLoc Pipeline">
      </div>

      <div class="sec-results">
        <h2>Example Results</h2>
        <div class="example-queries">
          <div class="example-query" onclick="setMap(this)">
            <img src="./examples/-3-2/_x_Hz1JjJ0hzeWlZ7yCANkg_query@37.746174@-122.425654@success.jpg" 
                 data-preds="examples/_3774617017357913_n12242565716621485@37.746170@-122.425657@success.png;./examples/-719/_37758964999232_n12239287238506438@37.758965@-122.392872@failure.png;./examples/-719/_3774617017357913_n12242565716621485@37.746170@-122.425657@failure.png">
          </div>
          <div class="example-query" onclick="setMap(this)">
            <img src="./examples/5-22/_JJ8TdU5_UQg_WE2qt8QbXQ_query@37.788169@-122.400728@success.jpg" 
                 data-preds="./examples/5-22/_3778816344751675_n12240075733242969@37.788163@-122.400757@success.png;./examples/-719/_37758964999232_n1224269021579041@37.758965@-122.426902@failure.png;./examples/-719/_3774617017357913_n12242565716621485@37.746170@-122.425657@failure.png">
          </div>
          <div class="example-query" onclick="setMap(this)">
            <img src="./examples/21-3/_syHN7G42ysmqRSABqg884A_query@37.750085@-122.394122@success.jpg" 
                 data-preds="./examples/21-3/_37750107043010786_n12239411737675364@37.750107@-122.394117@success.png;./examples/-719/_37758964999232_n1224269021579041@37.758965@-122.426902@failure.png">
          </div>
          <div class="example-query" onclick="setMap(this)">
            <img src="./examples/26-2/_U54rcLNA7eGddtzHmv5XAA_query@37.750408@-122.389556@success.jpg" 
                 data-preds="./examples/26-2/_3775043511546342_n12238955240722636@37.750435@-122.389552@success.png;./examples/26-2/_37750107043010786_n12238955240722636@37.750107@-122.389552@success.png;./examples/-719/_37750107043010786_n12239411737675364@37.750107@-122.394117@failure.png">
          </div>
        </div>
        <div id="map"></div>
        <p style="text-align: center; color: #666; margin-top: 10px;">
          Results may overlap - zoom in to see them all. Click on an image in the map to zoom in.
        </p>
      </div>
    </div>

    <!-- Hi²-GSLoc Section -->
    <div id="hi2gsloc" class="project-section">
      <div class="project-header">
        <h1>Hi²-GSLoc</h1>
        <div class="subtitle">Dual-Hierarchical Gaussian-Specific Visual Relocalization for Remote Sensing</div>
        <div class="authors">
          <div class="names">
            <a href="https://boni-hu.github.io/">Boni Hu</a><sup>1</sup>, 
            <a>Zhenyu Xia</a><sup>1</sup>, 
            <a>Lin Chen</a><sup>2</sup>, 
            <a>Pengcheng Han</a><sup>1</sup>, 
            <a>Shuhui Bu</a><sup>1</sup>
          </div>
          <div class="affiliations">
            <sup>1</sup>Northwestern Polytechnical University
          </div>
        </div>
        <div class="links">
          <a href="https://arxiv.org/abs/2507.15683">
            <img src="./icons/arxiv.svg" alt="Paper"/>
            Paper
          </a>
          <a href="https://github.com/boni-hu/CurriculumLoc">
            <img src="./icons/github.svg" alt="Code"/>
            Code
          </a>
          <a href="https://github.com/boni-hu/CurriculumLoc">
            <img src="./icons/images.svg" alt="Data"/>
            Data
          </a>
        </div>
      </div>

      <div class="sec-abstract">
        <h2>Abstract</h2>
        <p>Visual relocalization, which estimates the 6-degree-of-freedom (6-DoF) camera pose from query images, is fundamental to remote sensing and UAV applications. Existing methods face inherent trade-offs: image-based retrieval and pose regression approaches lack precision, while structure-based methods that register queries to Structure-from-Motion (SfM) models suffer from computational complexity and limited scalability. These challenges are particularly pronounced in remote sensing scenarios due to large-scale scenes, high altitude variations, and domain gaps of existing visual priors. To overcome these limitations, we leverage 3D Gaussian Splatting (3DGS) as a novel scene representation that compactly encodes both 3D geometry and appearance. We introduce Hi2-GSLoc, a dual-hierarchical relocalization framework that follows a sparse-to-dense and coarse-to-fine paradigm, fully exploiting the rich semantic information and geometric constraints inherent in Gaussian primitives. To handle large-scale remote sensing scenarios, we incorporate partitioned Gaussian training, GPU-accelerated parallel matching, and dynamic memory management strategies. Our approach consists of two stages: (1) a sparse stage featuring a Gaussian-specific consistent render-aware sampling strategy and landmark-guided detector for robust and accurate initial pose estimation, and (2) a dense stage that iteratively refines poses through coarse-to-fine dense rasterization matching while incorporating reliability verification. Through comprehensive evaluation on simulation data, public datasets, and real flight experiments, we demonstrate that our method delivers competitive localization accuracy, recall rate, and computational efficiency while effectively filtering unreliable pose estimates.</p>
      </div>

      <div class="sec-pipeline">
        <h2>Pipeline Overview</h2>
        <img src="gsloc-1.png" alt="Hi²-GSLoc Pipeline">
      </div>

      <div class="sec-video">
        <h2>Demo Video</h2>
        <iframe
          class="full-width-video"
          src="https://www.youtube.com/embed/IF1VuWw-dRE"
          title="YouTube video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  </div>

  <div class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
    ↑
  </div>

  <script src="index.js"></script>
  <script>
    // Back to top button
    window.addEventListener('scroll', function() {
      const backToTop = document.querySelector('.back-to-top');
      if (window.pageYOffset > 300) {
        backToTop.classList.add('show');
      } else {
        backToTop.classList.remove('show');
      }
    });

    // Map functionality
    let map;
    mapboxgl.accessToken = 'pk.eyJ1IjoiYm9uaWh1IiwiYSI6ImNsanVvdTR5czBicWgzZW8wYjJ2aWoxN3QifQ.yB9rZ5LdXFp0z0G5CIEh0A';

    function initMap() {
      map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [13.39, 52.49],
        zoom: 12
      });
    }

    function setMap(element) {
      const img = element.querySelector('img');
      const src = img.src;
      const preds = img.getAttribute('data-preds');
      
      if (!map) {
        initMap();
      }

      // Parse query coordinates
      const queryMatch = src.match(/@([\d.]+)@([\d.]+)@/);
      if (queryMatch) {
        const queryLat = parseFloat(queryMatch[1]);
        const queryLng = parseFloat(queryMatch[2]);
        
        // Clear existing markers
        document.querySelectorAll('.mapboxgl-marker').forEach(m => m.remove());
        
        // Add query marker
        new mapboxgl.Marker({color: 'red'})
          .setLngLat([queryLng, queryLat])
          .setPopup(new mapboxgl.Popup().setHTML('<img src="' + src + '" style="width:96px;height:auto;">'))
          .addTo(map);
        
        // Add prediction markers
        if (preds) {
          preds.split(';').forEach((pred, idx) => {
            const predMatch = pred.match(/@([\d.]+)@([\d.]+)@/);
            if (predMatch) {
              const predLat = parseFloat(predMatch[1]);
              const predLng = parseFloat(predMatch[2]);
              const isSuccess = pred.includes('success');
              
              new mapboxgl.Marker({color: isSuccess ? 'green' : 'orange'})
                .setLngLat([predLng, predLat])
                .setPopup(new mapboxgl.Popup().setHTML('<img src="' + pred + '" style="width:96px;height:auto;">'))
                .addTo(map);
            }
          });
        }
        
        // Center map
        map.flyTo({
          center: [queryLng, queryLat],
          zoom: 14
        });
      }
    }

    // Initialize map when page loads
    window.addEventListener('load', initMap);
